# CMS 残タスク・課題リスト

## 🚨 未実装の主要機能

### 1. データベース・API関連
- [x] **企業管理（Companies）テーブルの実装**
  - Prismaスキーマに定義追加済み
  - `/api/companies` エンドポイント実装済み
  - B2B顧客管理機能追加済み

- [x] **プロジェクト管理（Projects）テーブルの実装**
  - Prismaスキーマに定義追加済み
  - `/api/projects` エンドポイント実装済み
  - 案件管理機能追加済み

- [x] **EC・販売管理機能**
  - Products（商品）テーブル実装済み
  - Orders（注文）テーブル実装済み
  - OrderItems（注文明細）テーブル実装済み
  - `/api/products` エンドポイント実装済み
  - 決済機能（Stripe連携）は未実装

- [x] **クロスドメイン連携機能**
  - CORSミドルウェア実装済み（`/lib/cors.ts`）
  - CrossSiteActivityテーブル実装済み
  - ドメイン間のユーザートラッキング機能追加済み

- [x] **監査ログ（AuditLog）機能**
  - AuditLogテーブル実装済み
  - 監査ミドルウェア実装済み（`/lib/audit.ts`）
  - 重要操作の自動記録機能追加済み

## 🎨 UI/UX・WCAG2.2準拠の課題

### 2. アクセシビリティ改善
- [ ] **フォーカス管理の改善**
  - モーダルダイアログのフォーカストラップ未実装
  - ページ遷移時のフォーカスリセット処理なし
  - Skip to main contentリンクが一部ページにない

- [ ] **フォーム要素のアクセシビリティ**
  - 必須項目のaria-required属性が未設定
  - エラーメッセージとフォーム要素の関連付け（aria-describedby）不足
  - フォームバリデーションのリアルタイムフィードバック未実装

- [ ] **色コントラスト比の検証**
  - 一部のバッジやステータス表示でWCAG AA基準未達の可能性
  - ダークモードでのコントラスト比未検証

- [ ] **キーボードナビゲーション**
  - データテーブルの行選択・操作がキーボードで困難
  - ドロップダウンメニューのキーボード操作（矢印キー）未対応
  - タブ順序の最適化が必要

- [ ] **スクリーンリーダー対応**
  - 動的コンテンツ更新時のaria-live領域設定なし
  - グラフ・チャートの代替テキスト未提供
  - テーブルのヘッダー関連付け（scope属性）不完全

## 🔧 機能改善・バグ修正

### 3. ページネーション
- [ ] **ContentListコンポーネント**
  - ページネーションUI未実装（TODOコメントあり）
  - URLパラメータとの同期処理なし

- [ ] **その他のリスト表示**
  - リード一覧にページネーション未実装
  - フィードバック・リクエスト一覧のページネーション改善必要

### 4. 検索・フィルタリング
- [ ] **グローバル検索機能**
  - ヘッダーに検索バーなし
  - 全文検索API未実装

- [ ] **高度なフィルタリング**
  - 日付範囲フィルター未実装
  - 複数条件の組み合わせ検索未対応

### 5. 通知・リアルタイム機能
- [ ] **リアルタイム通知**
  - WebSocket/Server-Sent Events未実装
  - 新着通知のバッジ表示機能なし
  - プッシュ通知対応なし

- [ ] **通知センター**
  - 通知一覧画面未実装
  - 既読管理機能なし

## 📊 分析・レポート機能

### 6. 未実装の分析機能
- [ ] **売上分析（RevenueAnalytics）**
  - 売上ダッシュボード未実装
  - 月次・四半期レポート機能なし

- [ ] **KPIダッシュボード**
  - カスタムKPI設定機能なし
  - 目標値との比較表示なし

- [ ] **レポート生成**
  - PDF/CSVエクスポート機能未実装
  - 定期レポートの自動生成・送信機能なし

## 🔒 セキュリティ・権限管理

### 7. アクセス制御
- [ ] **ロールベースアクセス制御（RBAC）**
  - 管理者以外の権限レベル未実装
  - リソース単位の権限設定なし
  - 権限管理UI未実装

- [ ] **データ暗号化**
  - 個人情報の暗号化処理未実装
  - ENCRYPTION_KEYの利用箇所なし

- [ ] **GDPR対応**
  - データエクスポート機能未実装
  - データ削除（忘れられる権利）機能未実装
  - プライバシーポリシー同意管理未実装

## 🚀 パフォーマンス・運用

### 8. 最適化
- [ ] **画像最適化**
  - 画像アップロード・リサイズ機能未実装
  - Next.js Imageコンポーネント未使用

- [ ] **キャッシュ戦略**
  - APIレスポンスキャッシュ未実装
  - 静的データのキャッシュ最適化必要

### 9. 運用機能
- [ ] **バックアップ・リストア**
  - 自動バックアップ機能未実装
  - データリストアUI未実装

- [ ] **ヘルスチェック**
  - `/api/health` エンドポイント未実装
  - 外部サービス接続チェック未実装

- [ ] **バッチ処理**
  - 定期実行ジョブ（cron）未実装
  - データクリーンアップ処理なし

## 📱 レスポンシブ・モバイル対応

### 10. モバイル最適化
- [ ] **レスポンシブデザイン**
  - サイドバーのモバイル対応（ハンバーガーメニュー）未実装
  - テーブルのモバイル表示最適化必要
  - タッチ操作の最適化（スワイプ等）未対応

## 📝 ドキュメント・ヘルプ

### 11. ユーザーサポート
- [ ] **ヘルプページ**
  - `/help` ページ未実装（リンクのみ存在）
  - 操作マニュアル未作成
  - FAQ機能なし

- [ ] **開発者向けドキュメント**
  - API仕様書（OpenAPI/Swagger）未作成
  - コンポーネントライブラリ（Storybook等）未構築

## 🎯 優先度別対応推奨

### 高優先度（必須）
1. WCAG2.2準拠のアクセシビリティ改善
2. プロジェクト管理機能の実装
3. セキュリティ強化（RBAC、データ暗号化）
4. ページネーション・検索機能の完成

### 中優先度（重要）
5. 企業管理・B2B機能の実装
6. 売上分析・KPIダッシュボード
7. モバイル対応の改善
8. 通知機能の実装

### 低優先度（将来対応）
9. EC・販売管理機能
10. リアルタイム機能
11. 高度なレポート機能
12. ヘルプ・ドキュメント整備

## 💡 追加の推奨事項

### テスト・品質保証
- [ ] E2Eテスト（Playwright等）の導入
- [ ] アクセシビリティ自動テストの導入
- [ ] パフォーマンステストの実施

### 開発環境改善
- [ ] デバッグツールの強化
- [ ] 開発用シードデータの充実
- [ ] ローカル開発環境の最適化

## 🔨 実装上の注意事項

### データベース関連
- Prismaスキーマは更新済みですが、マイグレーションは手動で実行が必要
- 新しいテーブルを使用する際は、`npx prisma generate`の実行が必要
- 型エラーが発生する場合は、Prismaクライアントの再生成を試してください

### API実装
- 監査ログは`/lib/audit.ts`の関数を使用して記録
- CORS設定は`/lib/cors.ts`で管理
- 新しいAPIエンドポイントはミドルウェアで保護済み

### 実装済みAPI
- **企業管理API** - `/api/companies`
  - GET: 企業一覧取得（ページネーション、検索対応）
  - POST: 企業新規作成

- **プロジェクト管理API** - `/api/projects`
  - GET: プロジェクト一覧取得（フィルタリング対応）
  - POST: プロジェクト新規作成

### 次のステップ
1. **商品管理API（/api/products）の作成**
   - 商品の作成・更新・削除
   - 在庫管理機能

2. **注文管理API（/api/orders）の作成**
   - 注文処理
   - 決済連携（Stripe等）

3. **ダッシュボードUIの実装**
   - 企業管理画面
   - プロジェクト管理画面
   - 売上分析画面

4. **クロスドメイン連携の本番実装**
   - 両サイト間のシームレスな認証
   - ユーザー行動の統合分析

### 開発時の注意
- 型エラーが表示される場合は`npx prisma generate`を実行
- 新しいマイグレーション作成時は`npx prisma migrate dev`を使用
- ビルド確認は`npm run build`で実施
